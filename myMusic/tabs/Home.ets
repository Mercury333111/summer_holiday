import http from '@ohos.net.http';
import {SwiperModel,SongListModel,SingerModel} from '../model/AppModel'
import {getSwiperList,getRecommendSongList,getRecommendSinger} from '../common/Api'
import {ConfigUtil as Config} from '../common/ConfigUtil'
import router from '@ohos.router';
@Component
export struct Home{
  @State swiperList:SwiperModel[] = []
  @State songList:SongListModel[] = []
  @State singerList:SingerModel[] = []
  // èŽ·å–è½®æ’­å›¾æŽ¥å£
  async getSwiperData(){  /// async...await
    const res = await getSwiperList()
    this.swiperList = JSON.parse(JSON.stringify(res.data))
    console.log('swiperList'+ JSON.stringify(this.swiperList))
  }
  // èŽ·å–æŽ¨èæ­Œå•æŽ¥å£
  async recommendSongListData(){
    const res = await getRecommendSongList()
    this.songList = JSON.parse(JSON.stringify(res.data))

  }
  // èŽ·å–æŽ¨èæ­Œæ‰‹æŽ¥å£
  async recommendSingerData(){
    const res = await getRecommendSinger()
    this.singerList = JSON.parse(JSON.stringify(res.data))

  }
  // ç”Ÿå‘½å‘¨æœŸ
  aboutToAppear(): void {
    this.getSwiperData()
    this.recommendSongListData()
    this.recommendSingerData()
  }
  @Builder
  getSwiperListWidget(){
    Swiper() {
      ForEach(this.swiperList, (item: SwiperModel) => {
        Image(`${Config.SERVERURL}${item.imgurl}`)
          .width('100%')
          .height(200)
          .objectFit(ImageFit.Cover)
      }, (item: SwiperModel) => item.id.toString())
    }
    .loop(true)  //æ— é™å¾ªçŽ¯
    .autoPlay(true) // è‡ªåŠ¨æ’­æ”¾
    .interval(2000) // è½®æ’­é—´éš”æ—¶é—´
    //.displayArrow(true)
    .indicator(  // æŒ‡ç¤ºå™¨
      Indicator.dot()
        .left(0)
        .itemWidth(15)
        .itemHeight(15)
        .selectedItemWidth(30)
        .selectedItemHeight(15)
        .color('#999999')
        .selectedColor('#ff6600')
    )
    .height(230)
  }
  @Builder
  getSongListWidget(){
    //   æŽ¨èæ­Œå•
    Column() {
      this.TitleBar('æŽ¨èæ­Œå•')
      // æ­Œå•é¡¹
      Row() {
        Flex({
          wrap:FlexWrap.Wrap
        }){
          ForEach(this.songList, (item: SongListModel) => {
            Column() {
              Row() {
                Image(Config.SERVERURL +item.pic)
                  .width('100%')
                  .aspectRatio(1)
                  .borderRadius(8)
                Text(item.style)
                  .fontColor(Color.White)
                  .fontSize(12)
                  .fontWeight(FontWeight.Bold)
                  .position({
                    x: 6,
                    y: 6
                  })
              }
              Text(item.title)
                .textAlign(TextAlign.Start)
                .fontSize(12)
                .fontColor('#000000')
                .maxLines(2)
                .textOverflow({
                  overflow: TextOverflow.Ellipsis
                })
                .margin({
                  top: 8
                })
            }
            .justifyContent(FlexAlign.SpaceBetween)
            .width('33%')
            .onClick(()=>{
              router.pushUrl({
                url: 'pages/SongListDetail',
                params: {
                  cid: item.id
                }
              })
            })
          })
        }
      }
      .padding({
        left: 8,
        right: 8
      })
    }
  }
  @Builder
  getSingrWidget(){
    // æŽ¨èæ­Œæ‰‹
    Column() {
      this.TitleBar('æŽ¨èæ­Œæ‰‹')
      // æ­Œå•é¡¹
      Row() {
        Scroll() {
          Row({ space: 8 }) {
            ForEach(this.singerList, (item: SingerModel) => {
              Column() {
                Row() {
                  Image(Config.SERVERURL+item.pic)
                    .width('100%')
                    .borderRadius(8)
                  Text(item.name)
                    .fontColor(Color.White)
                    .fontSize(12)
                    .fontWeight(FontWeight.Bold)
                    .position({
                      x: 6,
                      y: 6
                    })
                }

                Text(item.name)
                  .textAlign(TextAlign.Start)
                  .fontSize(12)
                  .fontColor('#FFE9DFDF')
                  .maxLines(2)
                  .textOverflow({
                    overflow: TextOverflow.Ellipsis
                  })
                  .margin({
                    top: 8
                  })
              }
              .justifyContent(FlexAlign.SpaceBetween)
              .width('30%')
              .onClick(()=>{
                router.pushUrl({
                  url: 'pages/SingerDetail',
                  params: {
                    cid: item.id
                  }
                })
              })
            })
          }
        }
        .width('100%')
        .scrollable(ScrollDirection.Horizontal).scrollBar(BarState.Off)
      }
      .padding({
        left: 8,
        right: 8
      })
    }
  }
  // æ ‡é¢˜
  @Builder
  TitleBar(title: string) {
    // æ ‡é¢˜
    Row() {
      Text(title)
        .fontWeight(FontWeight.Bold)
        .fontColor(Color.Black)
        .fontSize(18)

      Text('æ›´å¤š')
        .fontColor(Color.Gray)
        .onClick(() => {
          if (title=='æŽ¨èæ­Œå•') {
            router.pushUrl({url:'pages/AllSongList'})
          }else{
            router.pushUrl({url:'pages/AllSingerList'})
          }
        })
    }
    .width('100%')
    .height(50)
    .padding(8)
    .justifyContent(FlexAlign.SpaceBetween)
  }
  // æœç´¢æ¡†
  @Builder
  SearchInput() {
    Row() {
      Row({ space: 4 }) {
        Image($r('app.media.ic_search'))
          .width(20)
          .aspectRatio(1)
          .fillColor('#6a828e')
        Text('ç”Ÿå¦‚å¤èŠ±ðŸ”¥')
          .fontColor('#6a828e')
          .layoutWeight(1)
        Image($r('app.media.ic_code'))
          .width(20)
          .aspectRatio(1)
          .fillColor('#6a828e')
      }
      .width('100%')
      .padding(12)
      .borderRadius('60')
      .backgroundColor('#cccccc')
      .onClick(()=> {
        router.pushUrl({
          url: "pages/Search1"
        })
      })
    }
    .width('100%')
    .padding(12)
  }
  build() {
    Column() {
      Scroll(){
        Column() {
          this.SearchInput()
          this.getSwiperListWidget()
          this.getSongListWidget()
          this.getSingrWidget()
        }
      }

    }
    .width('100%')
    .height('100%')
  }
}